---
title: "US Economic Outlook"
author: "satrio"
date: "2025-09-18"
output:
  html_document: default
  pdf_document: default
---

```{r setup, include=FALSE}
library(tidyverse)
library(ggplot2)
library(lubridate)
library(patchwork)
library(gt)
library(gtExtras)
library(ellmer)
library(jsonlite)

# parameters
cutoff_date <- as.character(ymd(Sys.Date()))

# fetch data
source("~/Economic_outlook/data_fetch.R")

# graph and table script
source("~/Economic_outlook/real_economy/data_viz_real_economy.R")

# set up AI behaviour
chat <- chat_ollama(model = "gpt-oss:120b-cloud", 
                    system_prompt = 
                 "You are an expert macroeconomist and you are tasked to create a
                 macroeconomic outlook report. Your answer should be in line with
                 the following rules:
                 
                 * Return only in paragraph.
                 * Be concise and coherent.
                 * Do not generate title.
                 * Return the answer in a nice markdown text, so that it can easily 
                 intergrated into Rmarkdown.
                 * Omit the first sentence of the answer like 'Okay here is the analysis etc'.
                 * Avoid complicated jargon and keep it easy to understand so that everyone can easily 
                 digest the report.
                 * One or two New Zealanders like banter would be great.")

# Download Real economy time series data
real_economy_id <- c("GDP", "GDPC1",
                     "INDPRO", "IPMAN", "IPDMAN", "IPNMAN", "IPMINE", "IPUTIL",
                     "RSXFS", "RSAFS", "RSMVPD")

real_economy_data <- pull_data_fred(series_vector = real_economy_id, start_date = "2000-01-30", end_date = "2025-09-22")

# gdp components
gdp_components_id <- c("PCECC96", "DGDSRX1Q020SBEA", "PCESVC96",
                       "GPDIC1", "CBIC1", "FPIC1",
                       "NETEXC", "EXPGSC1", "IMPGSC1",
                       "GCEC1", 
                       "A960RX1Q020SBEA")

gdp_components <- pull_data_fred(series_vector = gdp_components_id, start_date = "2001-01-30", end_date = "2025-09-22")

# labour market 
labour_market_id <- c("UNRATE", "PAYEMS", "LNS11300060", "JTSJOL", "AWHMAN", "CES0500000003")

labour_market_data <- pull_data_fred(series_vector = labour_market_id, start_date = "2000-01-30", end_date = "2025-09-22")


options(scipen = 999)
```

## Executive Summary:

-   Lorem Ipsum is simply dummy text of the printing and typesetting industry. Lorem Ipsum has been the industry's standard dummy text ever since the 1500s, when an unknown printer took a galley of type and scrambled it to make a type specimen book.

-   Lorem Ipsum is simply dummy text of the printing and typesetting industry. Lorem Ipsum has been the industry's standard dummy text ever since the 1500s, when an unknown printer took a galley of type and scrambled it to make a type specimen book.

-   Lorem Ipsum is simply dummy text of the printing and typesetting industry. Lorem Ipsum has been the industry's standard dummy text ever since the 1500s, when an unknown printer took a galley of type and scrambled it to make a type specimen book.

-   Lorem Ipsum is simply dummy text of the printing and typesetting industry. Lorem Ipsum has been the industry's standard dummy text ever since the 1500s, when an unknown printer took a galley of type and scrambled it to make a type specimen book.

## Real Economy Outlook

### GDP Analysis

```{r first paragraph, include=FALSE}
# Real GDP analysis
first_prompt <- chat$chat("You are working on writing a macroeconomic outlook report for the USA.
                 Right now, you are in the GDP analysis section and this section will be
                 divided into 5 paragraph. For the first paragraph, write up an explanation
                 on why GDP analysis is important for 100 words. Also, no need for summarization on the last sentence
                 of the paragraph.")
```

`r first_prompt`

```{r second paragraph, include=FALSE}
gdp_json_second_par <- gdp_line_chart_data_ai(data = real_economy_data,
                                              cutoff = "2018-01-01",
                                              type = "yoy_growth")

second_prompt <- chat$chat(paste0("After that brief explanation on GDP analysis, you are asked to write up 
                                  2 paragraphs. For the first paragraph, briefly give an introduction on
                                  USA economy in the context of GDP. For example latest data movements and 
                                  recent trends. As for the second paragraph, You will dig deeper into
                                  numbers showcasing movements and direction of the both Nominal and Real
                                  GDP growth rates.The first paragraph should consist at least 100 words
                                  whereas second paragraph cover at least 200 words. the dataset is provided
                                  to you in JSON format. Here is the JSON data:",  gdp_json_second_par))


```

#### Real & Nominal GDP level and Growth Rate

```{r Real GDP QoQ and YoY growth rate, echo=FALSE, fig.width=12, fig.height=8, warning=FALSE}
yoy_gdp_line <- gdp_line_chart(data = real_economy_data,
                               cutoff = "2018-01-01",
                               type = "yoy_growth")

qoq_gdp_line <- gdp_line_chart(data = real_economy_data,
                               cutoff = "2018-01-01",
                               type = "qoq_annualised")

yoy_gdp_line
```

`r second_prompt`

#### Nominal vs Real GDP table

```{r Nominal vs Real GDP table, echo=FALSE, warning=FALSE}
gdp_table_func(data = real_economy_data, cutoff = "2018-01-01", type = "growth")
```

#### Real GDP Component Driver

```{r bridging paragraph from Real & nominal to GDP component, include=FALSE}
third_prompt <- chat$chat("Now, you need to bridge previous analysis on Nominal and Real GDP growth rate to 
                          Real GDP components contribution towards Real GDP Growth Rate, 
                          which includes Consumption, Government spending, Investment, Net Export and Import, and
                          lastly the Residual. Write up a paragraph which consist of 70 words on why analysing 
                          contribution to real gdp growth from each components is important.")

```

`r third_prompt`

```{r Real GDP Component, echo=FALSE, fig.width=12, fig.height=8, warning=FALSE}
chart_gdp_comp <- gdp_component_chart(data1 = gdp_components, data2 = real_economy_data, cutoff = "2018-01-01")
chart_gdp_comp$contrib_comp
```

```{r fourth paragraph, include=FALSE}
gdp_comp_json <- gdp_comp_data_ai(data1 = gdp_components, data2 = real_economy_data, cutoff = "2018-01-01")

fourth_prompt <- chat$chat(paste0(
                          "You will need to analyse component contributions to Real GDP growth (YoY) chart.
                           Write up 2 paragraph with each has its own topic. First, describe the overall                                 trend of the components for at least 100 words. For example, Real GDP growth has
                           been dominated by consumption expenditure. Second paragraph, highlight the 
                           volatility from investment and government spending role on keeping real GDP growth 
                           afloat for 130 words in total. Here is data used for the chart in JSON format:", 
                          gdp_comp_json))
```

`r fourth_prompt`

#### Real GDP Contribution Table

```{r Real GDP Contribution Table, echo=FALSE, warning=FALSE}
gdp_contrib_table(data1 = gdp_components, data2 = real_economy_data, cutoff = "2018-01-01")
```

### Industrial Production & Retail Trade
